<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Chill Zone Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0f111a;color:#fff}
header{background:#111;padding:15px}
.topbar{display:flex;justify-content:space-between;align-items:center}
button{background:#00ffd5;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-weight:bold}
.container{max-width:900px;margin:auto;padding:20px}
.card{background:#1b1e2e;padding:15px;border-radius:10px;margin-bottom:15px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal-box{background:#1b1e2e;padding:20px;border-radius:10px;width:340px}
input{width:100%;padding:8px;margin:6px 0;border-radius:5px;border:none}
#balanceBox{color:#0f0;font-weight:bold}
.small{font-size:13px;color:#ccc}
hr{border:1px solid #333}
</style>
</head>

<body>

<header>
  <div class="topbar">
    <b>ğŸ® Chill Zone</b>
    <div style="display:flex;align-items:center;gap:8px">
      <div id="balanceBox" style="display:none">
        ğŸ’° <span id="balance">0</span> Ä‘
      </div>
      <button id="topupBtn" style="display:none" onclick="openTopup()">Náº¡p tiá»n</button>
      <div id="userBox">
        <button onclick="openLogin()">ÄÄƒng nháº­p</button>
        <button onclick="openRegister()">ÄÄƒng kÃ½</button>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <h2>ğŸ•¹ Acc Roblox</h2>

  <div class="card">
    <b>Acc Roblox VIP</b><br>
    TK: roblox_vip_01<br>
    GiÃ¡: 100.000Ä‘<br><br>
    <button onclick="buy(100000,'roblox_vip_01','vip123')">Mua acc</button>
  </div>

  <div class="card">
    <b>Acc Roblox ThÆ°á»ng</b><br>
    TK: roblox_normal_02<br>
    GiÃ¡: 70.000Ä‘<br><br>
    <button onclick="buy(70000,'roblox_normal_02','normal123')">Mua acc</button>
  </div>
</div>

<!-- LOGIN -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <h3>ÄÄƒng nháº­p</h3>
    <input id="loginEmail" placeholder="Email">
    <input id="loginPass" type="password" placeholder="Máº­t kháº©u">
    <button onclick="login()">ÄÄƒng nháº­p</button>
  </div>
</div>

<!-- REGISTER -->
<div class="modal" id="registerModal">
  <div class="modal-box">
    <h3>ÄÄƒng kÃ½</h3>
    <input id="regEmail" placeholder="Email">
    <input id="regPass" type="password" placeholder="Máº­t kháº©u">
    <button onclick="register()">ÄÄƒng kÃ½</button>
  </div>
</div>

<!-- TOPUP -->
<div class="modal" id="topupModal">
  <div class="modal-box">
    <h3>ğŸ’³ Náº¡p tiá»n</h3>
    <p><b>NgÃ¢n hÃ ng:</b> MB Bank</p>
    <p><b>STK:</b> 08999931122009</p>
    <p><b>Chá»§ TK:</b> NGUYEN NHAT TIEN</p>
    <p class="small">Ná»™i dung CK: <b>NAPTIEN &lt;EMAIL&gt;</b></p>
    <button onclick="openHistory()">ğŸ“œ Lá»‹ch sá»­ giao dá»‹ch</button>
  </div>
</div>

<!-- HISTORY -->
<div class="modal" id="historyModal">
  <div class="modal-box">
    <h3>ğŸ“œ Lá»‹ch sá»­ giao dá»‹ch</h3>
    <div id="historyList" style="max-height:300px;overflow:auto"></div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBTt-dcspPCo-cTn_hOozD5BRM7GWicIJc",
  authDomain: "misakashop-4dd4e.firebaseapp.com",
  projectId: "misakashop-4dd4e",
  storageBucket: "misakashop-4dd4e.appspot.com",
  messagingSenderId: "714456225230",
  appId: "1:714456225230:web:0d1f06b953e1c43833479f"
});

const auth = firebase.auth();
const db = firebase.firestore();

const loginModal = document.getElementById("loginModal");
const registerModal = document.getElementById("registerModal");
const topupModal = document.getElementById("topupModal");
const historyModal = document.getElementById("historyModal");
const historyList = document.getElementById("historyList");
const userBox = document.getElementById("userBox");
const balanceText = document.getElementById("balance");
const balanceBox = document.getElementById("balanceBox");
const topupBtn = document.getElementById("topupBtn");

function openLogin(){loginModal.style.display="flex"}
function openRegister(){registerModal.style.display="flex"}
function openTopup(){topupModal.style.display="flex"}

function register(){
  auth.createUserWithEmailAndPassword(regEmail.value, regPass.value)
  .then(cred=>{
    return db.collection("users").doc(cred.user.uid).set({
      email: cred.user.email,
      balance: 0,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
  }).then(()=>registerModal.style.display="none");
}

function login(){
  auth.signInWithEmailAndPassword(loginEmail.value, loginPass.value)
  .then(()=>loginModal.style.display="none");
}

auth.onAuthStateChanged(user=>{
  if(user){
    userBox.innerHTML = `<b>${user.email}</b> <button onclick="auth.signOut()">Logout</button>`;
    balanceBox.style.display="block";
    topupBtn.style.display="inline-block";

    db.collection("users").doc(user.uid)
    .onSnapshot(doc=>{
      if(doc.exists) balanceText.innerText = doc.data().balance.toLocaleString();
    });
  }
});

function buy(price,accUser,accPass){
  const user = auth.currentUser;
  if(!user){alert("ÄÄƒng nháº­p trÆ°á»›c");return;}

  const ref = db.collection("users").doc(user.uid);
  ref.get().then(doc=>{
    let bal = doc.data().balance;
    if(bal < price){alert("KhÃ´ng Ä‘á»§ sá»‘ dÆ°");return;}

    ref.update({balance: bal - price});
    ref.collection("transactions").add({
      username: accUser,
      password: accPass,
      price: price,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert(`MUA THÃ€NH CÃ”NG\nTK: ${accUser}\nMK: ${accPass}`);
  });
}

function openHistory(){
  const user = auth.currentUser;
  historyModal.style.display="flex";
  historyList.innerHTML="";

  db.collection("users").doc(user.uid)
  .collection("transactions")
  .orderBy("createdAt","desc")
  .onSnapshot(snap=>{
    historyList.innerHTML="";
    snap.forEach(d=>{
      let x=d.data();
      let t=x.createdAt?x.createdAt.toDate().toLocaleString():"";
      historyList.innerHTML+=`
        <div style="border-bottom:1px solid #333;padding:6px 0">
        ğŸ•’ ${t}<br>
        ğŸ’¸ ${x.price.toLocaleString()} Ä‘<br>
        ğŸ‘¤ ${x.username}<br>
        ğŸ”‘ ${x.password}
        </div>`;
    });
  });
}

window.onclick=e=>{
  if(e.target.classList.contains("modal")) e.target.style.display="none";
}
</script>

</body>
</html>
