<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Chill Zone Shop</title>
<style>
body{background:#0b0b0b;color:#fff;font-family:sans-serif}
.box{background:#151515;padding:15px;border-radius:8px;width:300px;margin:20px auto}
button{padding:8px 12px;border:0;border-radius:6px;background:#00ffc8;cursor:pointer}
input{width:100%;padding:8px;margin:6px 0}
.hidden{display:none}
</style>
</head>
<body>

<div class="box" id="authBox">
  <h3>Đăng nhập / Đăng ký</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Mật khẩu">
  <button onclick="login()">Đăng nhập</button>
  <button onclick="register()">Đăng ký</button>
</div>

<div class="box hidden" id="userBox">
  <h3>Xin chào <span id="userEmail"></span></h3>
  <p>Số dư: <b id="balance">0</b> đ</p>
  <button onclick="toggleNap()">Nạp tiền</button>

  <div id="napBox" class="hidden">
    <p><b>MB Bank</b></p>
    <p>STK: <b>08999931122009</b></p>
    <p>CTK: <b>NGUYEN NHAT TIEN</b></p>
    <p>Nội dung: email đăng nhập</p>
  </div>

  <hr>
  <h4>Acc Roblox #001</h4>
  <p>Giá: <b>0đ</b></p>
  <button onclick="buyAcc()">Mua acc</button>

  <div id="accInfo"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBTt-dcspPCo-cTn_hOozD5BRM7GWicIJc",
  authDomain: "misakashop-4dd4e.firebaseapp.com",
  projectId: "misakashop-4dd4e",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const authBox = document.getElementById("authBox");
const userBox = document.getElementById("userBox");
const balanceEl = document.getElementById("balance");
const userEmailEl = document.getElementById("userEmail");
const accInfo = document.getElementById("accInfo");

window.register = async () => {
  const email = email.value;
  const password = password.value;
  const res = await createUserWithEmailAndPassword(auth, email, password);
  await setDoc(doc(db, "users", res.user.uid), {
    email,
    balance: 0
  });
};

window.login = async () => {
  await signInWithEmailAndPassword(auth, email.value, password.value);
};

onAuthStateChanged(auth, async (user) => {
  if (!user) return;
  authBox.classList.add("hidden");
  userBox.classList.remove("hidden");
  userEmailEl.innerText = user.email;

  const snap = await getDoc(doc(db, "users", user.uid));
  balanceEl.innerText = snap.data().balance;
});

window.toggleNap = () => {
  document.getElementById("napBox").classList.toggle("hidden");
};

window.buyAcc = async () => {
  const user = auth.currentUser;
  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);

  if (snap.data().balance < 0) {
    alert("Không đủ tiền");
    return;
  }

  accInfo.innerHTML = `
    <hr>
    <p><b>TK:</b> tien2009</p>
    <p><b>MK:</b> 2009</p>
  `;
};
</script>

</body>
</html>
