<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Chill Zone Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0f111a;color:#fff}
header{background:#111;padding:15px;display:flex;justify-content:space-between;align-items:center}
button{background:#00ffd5;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-weight:bold}
.container{max-width:900px;margin:auto;padding:20px}
.card{background:#1b1e2e;padding:15px;border-radius:10px;margin-bottom:15px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal-box{background:#1b1e2e;padding:20px;border-radius:10px;width:300px}
input{width:100%;padding:8px;margin:6px 0;border-radius:5px;border:none}
#balanceBox{color:#0f0;font-weight:bold;margin-right:10px}
</style>
</head>

<body>

<header>
  <b>ğŸ® Chill Zone</b>
  <div style="display:flex;align-items:center;gap:8px">
    <div id="balanceBox" style="display:none">
      ğŸ’° <span id="balance">0</span> Ä‘
    </div>
    <div id="userBox">
      <button onclick="openLogin()">ÄÄƒng nháº­p</button>
      <button onclick="openRegister()">ÄÄƒng kÃ½</button>
    </div>
  </div>
</header>

<div class="container">
  <h2>Acc Roblox</h2>

  <div class="card">
    <b>Acc Roblox #001</b><br>
    Level 120 â€“ 1500 Robux<br>
    GiÃ¡: 100.000Ä‘<br><br>
    <button onclick="buy(100000)">Mua acc</button>
  </div>

  <div class="card">
    <b>Acc Roblox #002</b><br>
    Acc sáº¡ch â€“ Level 80<br>
    GiÃ¡: 70.000Ä‘<br><br>
    <button onclick="buy(70000)">Mua acc</button>
  </div>
</div>

<!-- LOGIN -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <h3>ÄÄƒng nháº­p</h3>
    <input id="loginEmail" placeholder="Email">
    <input id="loginPass" type="password" placeholder="Máº­t kháº©u">
    <button onclick="login()">ÄÄƒng nháº­p</button>
  </div>
</div>

<!-- REGISTER -->
<div class="modal" id="registerModal">
  <div class="modal-box">
    <h3>ÄÄƒng kÃ½</h3>
    <input id="regEmail" placeholder="Email">
    <input id="regPass" type="password" placeholder="Máº­t kháº©u">
    <button onclick="register()">ÄÄƒng kÃ½</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBTt-dcspPCo-cTn_hOozD5BRM7GWicIJc",
  authDomain: "misakashop-4dd4e.firebaseapp.com",
  projectId: "misakashop-4dd4e",
  storageBucket: "misakashop-4dd4e.appspot.com",
  messagingSenderId: "714456225230",
  appId: "1:714456225230:web:0d1f06b953e1c43833479f"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const loginModal = document.getElementById("loginModal");
const registerModal = document.getElementById("registerModal");
const userBox = document.getElementById("userBox");
const balanceBox = document.getElementById("balanceBox");
const balanceText = document.getElementById("balance");

function openLogin(){loginModal.style.display="flex"}
function openRegister(){registerModal.style.display="flex"}

function register(){
  auth.createUserWithEmailAndPassword(regEmail.value, regPass.value)
  .then(cred=>{
    return db.collection("users").doc(cred.user.uid).set({
      email: cred.user.email,
      balance: 0,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
  }).then(()=>{
    alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng");
    registerModal.style.display="none";
  }).catch(e=>alert(e.message));
}

function login(){
  auth.signInWithEmailAndPassword(loginEmail.value, loginPass.value)
  .then(()=>{
    loginModal.style.display="none";
  }).catch(e=>alert(e.message));
}

function logout(){
  auth.signOut();
  location.reload();
}

auth.onAuthStateChanged(user=>{
  if(user){
    userBox.innerHTML = `<b>${user.email}</b>
    <button onclick="logout()">Logout</button>`;
    balanceBox.style.display="block";

    db.collection("users").doc(user.uid)
    .onSnapshot(doc=>{
      if(doc.exists){
        balanceText.innerText =
          doc.data().balance.toLocaleString();
      }
    });
  }
});

function buy(price){
  const user = auth.currentUser;
  if(!user){
    alert("Vui lÃ²ng Ä‘Äƒng nháº­p");
    return;
  }

  const ref = db.collection("users").doc(user.uid);
  ref.get().then(doc=>{
    let bal = doc.data().balance;
    if(bal < price){
      alert("KhÃ´ng Ä‘á»§ sá»‘ dÆ°");
      return;
    }
    ref.update({ balance: bal - price });
    alert("Mua acc thÃ nh cÃ´ng (demo)");
  });
}

window.onclick = e=>{
  if(e.target.classList.contains("modal"))
    e.target.style.display="none";
}
</script>

</body>
</html>
